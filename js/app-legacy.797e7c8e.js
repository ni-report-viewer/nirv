(function(){"use strict";var t={8966:function(t,e,n){n.d(e,{Z:function(){return s}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",[n("strong",[t._v("Loading...")]),n("b-spinner",{staticClass:"ml-4",attrs:{variant:"primary",label:"loading"}})],1)},i=[],a={name:"TheSpinner"},o=a,u=n(1001),c=(0,u.Z)(o,r,i,!1,null,"1bef42a6",null),s=c.exports},8958:function(t,e,n){n(6992),n(8674),n(9601),n(7727);var r=n(538),i=n(5706),a=n(8262),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},u=[],c=n(5069),s=n(3017);n(44);r["default"].use(c.XG7),r["default"].use(s.X);var l={name:"App"},p=l,f=n(1001),d=(0,f.Z)(p,o,u,!1,null,null,null),h=d.exports,v=(n(1539),n(8783),n(3948),n(8345)),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",["getInput"===t.state?n("b-container",{staticClass:"px-0",attrs:{fluid:""}},[n("h1",[t._v("You've got some NiRV!")]),n("h3",{staticClass:"mt-5"},[t._v("Welcome to the Neuroimaging Report Viewer")]),n("p",{staticClass:"mt-4 text-left"},[t._v(" You can load data into NiRV using a few methods ")]),n("b-tabs",{attrs:{"content-class":"mt-3"}},[n("b-tab",{attrs:{title:"Use local files",active:""}},[n("b-form-group",{staticClass:"mt-4 text-left",attrs:{label:"Choose a directory containing input files generated by the NiRV BIDS-App.",description:"All computation happens on the client side. Your data will not be uploaded to any server."}},[n("b-form-file",{attrs:{directory:"",multiple:"",placeholder:"Choose a directory..."},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}})],1)],1),n("b-tab",{attrs:{title:"Use remote files"}},[n("b-input-group",{attrs:{prepend:"URI"}},[n("b-form-input",{attrs:{placeholder:"s3://nirv-example-data"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.navigate.apply(null,arguments)}},model:{value:t.uri,callback:function(e){t.uri=e},expression:"uri"}}),n("b-input-group-append",[n("b-btn",{attrs:{text:"Button",variant:"primary"},on:{click:t.navigate}},[t._v("Go")])],1)],1)],1),n("b-tab",{attrs:{title:"Load a demo dataset"}},[n("b-form-group",{staticClass:"mt-4 text-left"},[n("b-form-select",{attrs:{options:t.datasets},scopedSlots:t._u([{key:"first",fn:function(){return[n("b-form-select-option",{attrs:{value:null,disabled:""}},[t._v("-- Select a demonstration dataset --")])]},proxy:!0}],null,!1,2800293670),model:{value:t.selectedDataset,callback:function(e){t.selectedDataset=e},expression:"selectedDataset"}})],1)],1)],1),n("b-modal",{attrs:{id:"files-not-found-modal","hide-footer":""},model:{value:t.showErrorModal,callback:function(e){t.showErrorModal=e},expression:"showErrorModal"}},[n("div",{staticClass:"d-block text-center"},[n("h3",[t._v("Error!")]),n("p",[t._v(" NiRV was unable to find the required "),n("code",[t._v("nirv_group_report.csv")]),t._v(" or "),n("code",[t._v("nirv_group_report.json")]),t._v(" files. ")])]),n("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:t.hideErrorModal}},[t._v("Close")])],1)],1):t._e(),"showSpinner"===t.state?n("TheSpinner"):t._e()],1)},b=[],g=n(6198),w=(n(5666),n(6699),n(2023),n(7833)),y=n(8966),_=n(5108),k={name:"HomeView",components:{TheSpinner:y.Z},setup:function(){var t=(0,w.n)(),e=(0,i.iH)("getInput"),n=(0,i.iH)(null),r=(0,i.iH)(null),a=[{text:"Healthy Brain Network -- QSIPrep",value:"hbn-qsiprep"},{text:"Healthy Brain Network -- pyAFQ",value:"hbn-pyafq"},{text:"NKI Rockland -- QSIPrep",value:"nki-qsiprep"},{text:"NKI Rockland -- pyAFQ",value:"nki-pyafq"}],o=(0,i.iH)(null),u=(0,i.iH)(!1),c=function(){u.value=!1};(0,i.YP)(n,(0,g.Z)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.value){r.next=5;break}return e.value="showSpinner",r.next=4,t.parseFiles(n.value).catch((function(t){if(t.message.includes("NiRV")&&t.message.includes("file not found"))return u.value=!0,void(e.value="getInput")}));case 4:O.push({name:"Report"});case 5:case"end":return r.stop()}}),r)}))));var s=function(){var t=(0,g.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.value="showSpinner",r.value&&_.log(r.value);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{datasets:a,files:n,uri:r,hideErrorModal:c,selectedDataset:o,showErrorModal:u,state:e,navigate:s}}},R=k,x=(0,f.Z)(R,m,b,!1,null,"2d928320",null),P=x.exports;r["default"].use(v.Z);var O=new v.Z({routes:[{path:"/",name:"Home",component:P},{path:"/report",name:"Report",component:function(){return n.e(983).then(n.bind(n,468))}},{path:"/:pathMatch(.*)*",name:"NotFound",component:function(){return n.e(449).then(n.bind(n,1435))}}]}),S=!1;r["default"].config.productionTip=!1,r["default"].config.performance=S,r["default"].use(a.og),r["default"].use(i.ZP);var j=(0,a.WB)();new r["default"]({pinia:j,el:"#app",router:O,components:{App:h},template:"<App/>"})},7833:function(t,e,n){n.d(e,{n:function(){return T}});var r,i,a,o=n(8932),u=n(6198),c=(n(5666),n(2707),n(7327),n(1539),n(7941),n(6699),n(2023),n(8309),n(1703),n(189),n(8783),n(3948),n(1249),n(7852),n(8262)),s=n(3274),l=n(4367),p=(n(4916),n(3123),n(7714),n(2801),n(1174),n(5306),n(9600),n(6486)),f=n.n(p),d=n(7460),h=n.n(d),v=["path_to_report"],m=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file";return"file"===e?t.webkitRelativePath.split("/").length:"s3"===e?t.split("/").length:void 0},b=function(t){if(1===t.length)return t[0];var e=f().groupBy(t,m),n=Math.min.apply(Math,(0,o.Z)(Object.keys(e))),r=e[n];return 1===r.length?r[0]:null},g=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,r){h().parse(t,{download:e,header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:function(t){return n(t.data)},error:r})}))},w=function(t){var e=new FileReader;return new Promise((function(n,r){e.onerror=function(){e.abort(),r(new DOMException("Problem parsing input file."))},e.onload=function(){n({file:t,contents:JSON.parse(e.result)})},e.readAsText(t)}))},y=function(t){return t.map((function(t){return(0,l.Z)({participant_session_id:"session_id"in t?[t.participant_id,t.session_id].join("_").replace(/_+$/,"").replace("_"," "):t.participant_id},t)}))},_=function(t){return t.map((function(t){t.path_to_report;var e=(0,s.Z)(t,v);return e}))},k=function(t){return t.reduce((function(t,e){return t[e.participant_session_id]=e.path_to_report,t}),{})},R=(n(2479),n(4747),n(285),n(1637),function(){var t=(0,u.Z)(regeneratorRuntime.mark((function t(e){var n,r,i,a,o,u,c,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=f().filter(Object.values(e),(function(t){return t.reviewed})),r=n.map((function(t){return f().pick(t,["subject","rating","whenRated"])})),0!==r.length){t.next=4;break}return t.abrupt("return");case 4:i=",",a=Object.keys(r[0]).join(i)+"\n",o=a,r.forEach((function(t){o+=Object.values(t).join(i)+"\n"})),u=new Blob([o],{type:"text/csv"}),c=URL.createObjectURL(u),s=document.createElement("a"),s.href=c,s.target="_blank",l=(new Date).toISOString().replace(/[-:]/g,"").split(".")[0],s.download="dwiqc_ratings_"+l+".csv",s.click();case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),x=function(t){return f().reduce(Object.keys(t),(function(t,e){return t[e]={participant:e,rating:null,whenRated:null,reviewed:!1},t}),{})},P=function(t){return new Promise((function(e,n){h().parse(t,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:function(t){return t.data.reduce((function(t,e){return t[e.subject]=Object.assign({reviewed:!0},e),t}),{})},error:n})}))},O=n(3208),S=n(2032),j=(n(4723),n(6755),n(8992),n(6470)),C=function(t){var e=new FileReader;return new Promise((function(n,r){e.onerror=function(){e.abort(),r(new DOMException("Problem parsing input file."))},e.onload=function(){n(e.result)},e.readAsText(t)}))},E=/sub-[a-z0-9]+/gi,A=function(t){return t.match(E)},F=function(t){var e=new FileReader;return new Promise((function(n,r){e.onerror=function(t){e.abort(),r(t)},e.onload=function(t){n(t.target.result)},e.readAsDataURL(t)}))},N=function(t,e){var n=(0,j.relative)((0,j.dirname)(t),e);return n.startsWith(".")?n:"./".concat(n)},Z=function(t,e,n){var o,u=t.querySelectorAll("[src],[data],[href]"),c=(0,S.Z)(u);try{for(c.s();!(o=c.n()).done;){var s=o.value;s.getAttribute("src")===e?s.setAttribute("src",String.raw(r||(r=(0,O.Z)(["",""])),n)):s.getAttribute("data")===e?s.setAttribute("data",String.raw(i||(i=(0,O.Z)(["",""])),n)):s.getAttribute("href")===e&&(s.setAttribute("href",String.raw(a||(a=(0,O.Z)(["",""])),n)),s.setAttribute("download",(0,j.basename)(e)))}}catch(l){c.e(l)}finally{c.f()}return t},M=function(){var t=(0,u.Z)(regeneratorRuntime.mark((function t(e,n,r){var i,a,o,u,c,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=r.filter((function(t){var r=N(n,t.$path);return t.$path!==n&&e.includes(r)})),a=(new DOMParser).parseFromString(e,"text/html"),o=(0,S.Z)(i),t.prev=3,o.s();case 5:if((u=o.n()).done){t.next=14;break}return c=u.value,s=N(n,c.$path),t.next=10,F(c);case 10:l=t.sent,a=Z(a,s,l);case 12:t.next=5;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](3),o.e(t.t0);case 19:return t.prev=19,o.f(),t.finish(19);case 22:return t.abrupt("return",(new XMLSerializer).serializeToString(a));case 23:case"end":return t.stop()}}),t,null,[[3,16,19,22]])})));return function(e,n,r){return t.apply(this,arguments)}}(),T=(0,c.Q_)({id:"report",state:function(){return{inputFiles:null,inputPaths:null,brushedParticipants:[],inputCsv:null,inputJson:null,inputJsonFile:null,participantRatings:null,participantMetrics:null,participantReports:null,participantReportPaths:null,currentParticipant:"study",currentHtml:null,sidebarFilter:""}},getters:{studyId:function(t){var e;return(null===(e=t.inputJson)||void 0===e?void 0:e.studyId)||"Study"},metricMetadata:function(t){var e;return null===(e=t.inputJson)||void 0===e?void 0:e.variables},metricOptions:function(t){return t.participantMetrics?Object.keys(t.participantMetrics[0]).filter((function(t){return!["participant_id","subject_id","subject_session_id","participant_session_id","session_id","file_name"].includes(t)})).sort():null},currentReport:function(t){return t.participantReports&&"study"!==t.currentParticipant?t.participantReports[t.currentParticipant]:null},allParticipants:function(t){return t.participantReports?Object.keys(t.participantReports):null},filteredParticipants:function(t){return t.sidebarFilter?t.allParticipants.filter((function(e){return e.includes(t.sidebarFilter)})):t.allParticipants}},actions:{parseFiles:function(t){var e=this;return(0,u.Z)(regeneratorRuntime.mark((function n(){var r,i,a,u,c,s,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.filter((function(t){return"nirv_group_report.csv"===t.name})),i=t.filter((function(t){return"nirv_group_report.json"===t.name})),0!==r.length){n.next=4;break}throw new Error("NiRV CSV file not found.");case 4:if(0!==i.length){n.next=6;break}throw new Error("NiRV JSON file not found.");case 6:return n.t0=y,n.next=9,g(b(r));case 9:return n.t1=n.sent,e.inputCsv=(0,n.t0)(n.t1),e.participantMetrics=_(e.inputCsv),e.participantReportPaths=k(e.inputCsv),a=(0,o.Z)(new Set(e.inputCsv.map((function(t){return t.participant_id})))),e.inputFiles=a.reduce((function(e,n){return e[n]=t.filter((function(t){return t.$path.includes(n)})),e}),{}),e.inputPaths=a.reduce((function(e,n){return e[n]=t.filter((function(t){return t.$path.includes(n)})).map((function(t){return t.webkitRelativePath})),e}),{}),u=t.filter((function(t){return t.name.endsWith(".html")})),e.participantReports=Object.keys(e.participantReportPaths).reduce((function(t,n){return t[n]=u.filter((function(t){return t.$path.includes(e.participantReportPaths[n])}))[0],t}),{}),n.next=20,w(b(i));case 20:c=n.sent,s=c.file,l=c.contents,e.inputJson=l,e.inputJsonFile=s,e.participantRatings=x(e.participantReports);case 26:case"end":return n.stop()}}),n)})))()},assignRating:function(t){this.participantRatings=Object.assign(this.participantRatings,t)},resetPartialRating:function(){"study"!==this.currentParticipant&&(this.participantRatings[this.currentParticipant].reviewed=!1,this.participantRatings[this.currentParticipant].whenRated=null)},downloadRatings:function(){R(this.participantRatings)},readRatingsCsv:function(t){P(t)},nextParticipant:function(){var t="study"!==this.currentParticipant?(this.filteredParticipants.indexOf(this.currentParticipant)+1)%this.filteredParticipants.length:0;this.selectParticipant(this.filteredParticipants[t])},selectParticipant:function(t){var e=this;if(this.currentParticipant=t,this.currentHtml=null,"study"!==t){var n=A(t);C(this.currentReport).then((function(t){return M(t,e.currentReport.$path,e.inputFiles[n])})).then((function(t){e.currentHtml=t}))}}}})}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=t,function(){var t=[];n.O=function(e,r,i,a){if(!r){var o=1/0;for(l=0;l<t.length;l++){r=t[l][0],i=t[l][1],a=t[l][2];for(var u=!0,c=0;c<r.length;c++)(!1&a||o>=a)&&Object.keys(n.O).every((function(t){return n.O[t](r[c])}))?r.splice(c--,1):(u=!1,a<o&&(o=a));if(u){t.splice(l--,1);var s=i();void 0!==s&&(e=s)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[r,i,a]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,r){return n.f[r](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+{449:"notFound",983:"report"}[t]+"-legacy."+{449:"cf792234",983:"f4b307ee"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/report.9e2a5e17.css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="nirv:";n.l=function(r,i,a,o){if(t[r])t[r].push(i);else{var u,c;if(void 0!==a)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var p=s[l];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==e+a){u=p;break}}u||(c=!0,u=document.createElement("script"),u.charset="utf-8",u.timeout=120,n.nc&&u.setAttribute("nonce",n.nc),u.setAttribute("data-webpack",e+a),u.src=r),t[r]=[i];var f=function(e,n){u.onerror=u.onload=null,clearTimeout(d);var i=t[r];if(delete t[r],u.parentNode&&u.parentNode.removeChild(u),i&&i.forEach((function(t){return t(n)})),e)return e(n)},d=setTimeout(f.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=f.bind(null,u.onerror),u.onload=f.bind(null,u.onload),c&&document.head.appendChild(u)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){n.p="/nirv/"}(),function(){var t=function(t,e,n,r){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var a=function(a){if(i.onerror=i.onload=null,"load"===a.type)n();else{var o=a&&("load"===a.type?"missing":a.type),u=a&&a.target&&a.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+u+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=o,c.request=u,i.parentNode.removeChild(i),r(c)}};return i.onerror=i.onload=a,i.href=e,document.head.appendChild(i),i},e=function(t,e){for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var i=n[r],a=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(a===t||a===e))return i}var o=document.getElementsByTagName("style");for(r=0;r<o.length;r++){i=o[r],a=i.getAttribute("data-href");if(a===t||a===e)return i}},r=function(r){return new Promise((function(i,a){var o=n.miniCssF(r),u=n.p+o;if(e(o,u))return i();t(r,u,i,a)}))},i={143:0};n.f.miniCss=function(t,e){var n={983:1};i[t]?e.push(i[t]):0!==i[t]&&n[t]&&e.push(i[t]=r(t).then((function(){i[t]=0}),(function(e){throw delete i[t],e})))}}(),function(){var t={143:0};n.f.j=function(e,r){var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise((function(n,r){i=t[e]=[n,r]}));r.push(i[2]=a);var o=n.p+n.u(e),u=new Error,c=function(r){if(n.o(t,e)&&(i=t[e],0!==i&&(t[e]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;u.message="Loading chunk "+e+" failed.\n("+a+": "+o+")",u.name="ChunkLoadError",u.type=a,u.request=o,i[1](u)}};n.l(o,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,r){var i,a,o=r[0],u=r[1],c=r[2],s=0;if(o.some((function(e){return 0!==t[e]}))){for(i in u)n.o(u,i)&&(n.m[i]=u[i]);if(c)var l=c(n)}for(e&&e(r);s<o.length;s++)a=o[s],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return n.O(l)},r=self["webpackChunknirv"]=self["webpackChunknirv"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(8958)}));r=n.O(r)})();
//# sourceMappingURL=app-legacy.797e7c8e.js.map